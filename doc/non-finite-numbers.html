<!DOCTYPE html>
<html lang='en'>
<head>
<link rel='icon' href='webpkiorg.png' sizes='192x192'>
<meta name='viewport' content='initial-scale=1.0'>
<meta charset="utf-8">
<title>Non-Finite Numbers</title>
<link rel='stylesheet' type='text/css' href='style.css'>
</head>
<body>
<a href='index.html'><img src='back.svg' style='width:2em' title='back to main document'></a>
<h3>Non-Finite Numbers</h3>
Unlike JSON&nbsp;[<a href='https://www.rfc-editor.org/rfc/rfc8259.html'
title="JSON">RFC&nbsp;8259<img src="xtl.svg" alt="link"></a>],
CBOR supports the non-finite floating-point constructs defined by <span style='white-space:nowrap'><code>IEEE</code> <code>754</code></span>, known as
<code>NaN</code> (not a number) and <code>Infinity</code>.
This implementation provides multiple levels of support, intended to
accommodate different needs.
This is accomplished without specific decoder or encoder options;
it is entirely based on API method selections.
The following table outlines the supported levels:
<div class='webpkifloat' style='margin-left:2em'><table class='webpkitable' style='min-width:30em'>
<tr><th>Level</th><th>Comment</th></tr>
<tr><td style='text-align:center'><code>BASIC</code></td><td>Only "regular" floating-point numbers are accepted.
</td></tr>
<tr><td style='text-align:center'><code>EXTENDED</code></td><td>All floating-point numbers except for <code>NaN</code> with payloads are accepted.
<div style='margin-top:0.5em'>In the list below, <code>NaN</code> refers to "simple" <code>NaNs</code>
(in deterministically encoded CBOR represented by <code>f97e00</code>),
while <code>Infinity</code> refers to
positive infinity (<code>f97c00</code>) and negative infinity (<code>f9fc00</code>).
The JavaScript counterparts are represented by <code>Number.NaN</code>,
<code>Number.POSITIVE_INFINITY</code>,
and <code>Number.NEGATIVE_INFINITY</code> respectively.</div>
</td></tr>
<tr><td style='text-align:center'><code>COMPLETE</code></td><td>All floating-point numbers are accepted.
</td></tr>
</table></div>
Non-supported items cause an exception to be thrown.
Note that the constraints apply to <i>encoding</i> as well.
<h5 style='margin:1.3em 0 1em 0'>Encoding Methods</h5>
<div class='webpkifloat'>
<table style='margin-left:2em;font-family: monospace;white-space:nowrap;border-spacing:0'>
<tr><td colspan='2'>BASIC</td></tr>
<tr><td style='padding-left:1.2em'><a href='index.html#wrapper.cbor.float'>CBOR.Float(value)</a></td><td>// "Regular" number</td></tr>
<tr><td colspan='2' style='padding-top:0.8em'>EXTENDED</td></tr>
<tr><td style='padding-left:1.2em'><a href='index.html#cbor.float.cbor.float.createextendedfloat'>CBOR.Float.createExtendedFloat(value)</a></td><td>// "Regular" number, NaN, or Infinity</td></tr>
<tr><td colspan='2' style='padding-top:0.8em'>COMPLETE</td></tr>
<tr><td style='padding-left:1.2em'>// Select suitable method:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td></td></tr>
<tr><td style='padding-left:1.2em'><a href='index.html#wrapper.cbor.float'>CBOR.Float(value)</a></td><td>// "Regular" number</td></tr>
<tr><td style='padding-left:1.2em'><a href='index.html#wrapper.cbor.nonfinite'>CBOR.NonFinite(value)</a></td><td>// Arbitrary non-finite number</td></tr>
<tr><td style='padding-left:1.2em'><a href='index.html#cbor.nonfinite.cbor.nonfinite.createpayloadobject'>CBOR.NonFinite.createPayload(payload)</a></td><td>// Application-specific data</td></tr>
</table>
</div>
<h5 style='margin:1.3em 0 1em 0'>Decoding Methods</h5>
<div class='webpkifloat'>
<table style='margin-left:2em;font-family: monospace;white-space:nowrap;border-spacing:0'>
<tr><td colspan='2'>BASIC</td></tr>
<tr><td style='padding-left:1.2em'>cborObject.<a href='index.html#cbor.float.getfloat64'>getFloat64()</a></td><td>// "Regular" number</td></tr>
<tr><td colspan='2' style='padding-top:0.8em'>EXTENDED</td></tr>
<tr><td style='padding-left:1.2em'>cborObject.<a href='index.html#cbor.float.getextendedfloat64'>getExtendedFloat64()</a></td><td>// "Regular" number, NaN, or Infinity</td></tr>
<tr><td colspan='2' style='padding-top:0.8em'>COMPLETE</td></tr>
<tr><td style='padding-left:1.2em'>// Check what the decoder returned:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td></td></tr>
<tr><td colspan='2' style='padding-left:1.2em'>if (cborObject instanceof CBOR.NonFinite) {</td></tr>
<tr><td style='padding-left:1.2em'>&nbsp;&nbsp;// Non-finite number to process</td><td></td></tr>
<tr><td style='padding-left:1.2em'>&nbsp;&nbsp;// Select suitable method:</td><td></td></tr>
<tr><td style='padding-left:1.2em'>&nbsp;&nbsp;cborObject.<a href='index.html#cbor.nonfinite.getnonfinite64'>getNonFinite64()</a></td><td>// Arbitrary non-finite number</td></tr>
<tr><td style='padding-left:1.2em'>&nbsp;&nbsp;cborObject.<a href='index.html#cbor.nonfinite.getpayload'>getPayload()</a></td><td>// Application-specific data</td></tr>
<tr><td style='padding-left:1.2em'>} else {</td><td></td></tr>
<tr><td style='padding-left:1.2em'>&nbsp;&nbsp;// "Regular" number to process</td><td></td></tr>
<tr><td style='padding-left:1.2em'>&nbsp;&nbsp;cborObject.<a href='index.html#cbor.float.getfloat64'>getFloat64()</a></td><td>// "Regular" number</td></tr>
<tr><td style='padding-left:1.2em'>}</td><td></td></tr>
</table>
</div>
<h3 id='payload-option' style='padding-top:0.5em'>Payload Option</h3>
<div>
Traditionally, the non-finite number space is used for propagating
math-related problems such as division by zero.
</div>
<div style='margin-top:0.5em'>
However, in some cases there may be a desire providing more application specific data,
like information related to a faulty sensor that needs attention.
The <a href='index.html#cbor.nonfinite.cbor.nonfinite.createpayloadobject'>CBOR.NonFinite.createPayload(payload)</a>
and <a href='index.html#cbor.nonfinite.getpayload'>getPayload()</a>
methods were designed for this particular purpose.
The following table represents these methods from a <i>developer</i> perspective:
</div>
<div class='webpkifloat'><table class='webpkitable' style='margin-left:2em'>
<tr><th>Payload</th></tr>
<tr><td><code>d51-d0</code> in <i>big-endian</i> order</td></tr>
</table></div>
<div style='margin-top:0.5em'>
The payload bits are conceptually put into an <span style='white-space:nowrap'><code>IEEE</code> <code>754</code></span>
<code>64</code>-bit object having the following layout:
</div>
<div class='webpkifloat'><table class='webpkitable' style='margin-left:2em'>
<tr><th>Sign</th><th>Exponent</th><th>Significand</th></tr>
<tr style='text-align:center'><td>0</td><td>11111111111</td><td style='white-space:nowrap'><code>d0-d51</code> in <i>little-endian</i> order</td></tr>
</table></div>
<div>
For setting the sign bit, see <a href='index.html#cbor.nonfinite.setsign'>setSign(sign)</a>.
</div>
<div style='margin-top:0.7em'>
The reason for <i>reversing</i> the payload bits is to ensure that a specific bit will remain
in a fix position (maintain the same value), independent of the size of the
<code>IEEE 754</code> variant used for encoding.
</div>
<div style='margin-top:0.7em'>
Note that the encoder will (due to CBOR deterministic encoding rules), select
the shortest serialization required to properly represent the payload.
The following table shows a few examples:
</div>
<div class='webpkifloat'><table class='webpkitable' style='margin-left:2em'>
<tr><th>Payload (hex)</th><th>CBOR Encoding</th><th>Diagnostic Notation</th></tr>
<tr><td style='text-align:right'><code>0</code></td><td style='text-align:right'><code>f97c00</code></td><td><code>Infinity</code></td></tr>
<tr><td style='text-align:right'><code>1</code></td><td style='text-align:right'><code>f97e00</code></td><td><code>NaN</code></td></tr>
<tr><td style='text-align:right'><code>2</code></td><td style='text-align:right'><code>f97d00</code></td><td><code>float'7d00'</code></td></tr>
<tr><td style='text-align:right'><code>3ff</code></td><td style='text-align:right'><code>f97fff</code></td><td><code>float'7fff'</code></td></tr>
<tr><td style='text-align:right'><code>400</code></td><td style='text-align:right'><code>fa7f801000</code></td><td><code>float'7f801000'</code></td></tr>
<tr><td style='text-align:right'><code>7fffff</code></td><td style='text-align:right'><code>fa7fffffff</code></td><td><code>float'7fffffff'</code></td></tr>
<tr><td style='text-align:right'><code>800000</code></td><td style='text-align:right'><code>fb7ff0000010000000</code></td><td><code>float'7ff0000010000000'</code></td></tr>
<tr><td style='text-align:right'><code>fffffffffffff</code></td><td style='text-align:right'><code>fb7fffffffffffffff</code></td><td><code>float'7fffffffffffffff'</code></td></tr>
</table></div>
A payload of <code>0</code> and having the sign bit set, would encode as <code>f9fc00</code> (<code>-Infinity</code>). 
</body>
</html>